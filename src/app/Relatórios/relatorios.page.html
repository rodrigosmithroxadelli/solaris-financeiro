<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Relatórios</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Filtros -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Filtros</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">Período</ion-label>
        <ion-select [(ngModel)]="periodType" (ionChange)="onPeriodChange()">
          <ion-select-option value="dia">Diário</ion-select-option>
          <ion-select-option value="semana">Semanal</ion-select-option>
          <ion-select-option value="mes">Mensal</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Data</ion-label>
        <ion-datetime-button datetime="report-datetime"></ion-datetime-button>
        <ion-modal [keepContentsMounted]="true">
          <ng-template>
            <ion-datetime
              id="report-datetime"
              [(ngModel)]="selectedDate"
              (ionChange)="onDateChange($event)"
              [presentation]="periodType === 'mes' ? 'month-year' : 'date'"
            ></ion-datetime>
          </ng-template>
        </ion-modal>
      </ion-item>

      <div class="export-buttons">
        <ion-button expand="block" color="danger" (click)="exportPDF()">
          <ion-icon name="download" slot="start"></ion-icon>
          Exportar PDF
        </ion-button>
        <ion-button expand="block" color="success" (click)="exportExcel()">
          <ion-icon name="download" slot="start"></ion-icon>
          Exportar Excel
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Resumo do Período -->
  <ion-card *ngIf="summary" color="primary">
    <ion-card-header>
      <ion-card-title>Resumo do Período</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Entradas</div>
          <div class="summary-value success">{{ financeService.formatCurrency(summary.totalEntradas) }}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Saídas</div>
          <div class="summary-value danger">{{ financeService.formatCurrency(summary.totalSaidas) }}</div>
        </div>
        <div class="summary-item full-width">
          <div class="summary-label">Saldo</div>
          <div class="summary-value" [class.success]="summary.saldo >= 0" [class.danger]="summary.saldo < 0">
            {{ financeService.formatCurrency(summary.saldo) }}
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Gráfico Comparativo Entradas x Saídas -->
  <ion-card *ngIf="summary">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="bar-chart"></ion-icon>
        Entradas x Saídas
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="comparison-chart">
        <div class="chart-row">
          <div class="chart-label">Entradas</div>
          <div class="chart-bar-container">
            <div 
              class="chart-bar-fill success" 
              [style.width.%]="getComparisonPercentage(summary.totalEntradas)"
            ></div>
            <span class="chart-value-inline">{{ financeService.formatCurrency(summary.totalEntradas) }}</span>
          </div>
        </div>
        <div class="chart-row">
          <div class="chart-label">Saídas</div>
          <div class="chart-bar-container">
            <div 
              class="chart-bar-fill danger" 
              [style.width.%]="getComparisonPercentage(summary.totalSaidas)"
            ></div>
            <span class="chart-value-inline">{{ financeService.formatCurrency(summary.totalSaidas) }}</span>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Por Categoria -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="pie-chart"></ion-icon>
        Por Categoria
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div *ngIf="getCategoryEntries().length > 0; else noCategoryData">
        <div *ngFor="let item of getCategoryEntries()" class="chart-item">
          <div class="chart-label">{{ item.category }}</div>
          <div class="chart-bar">
            <div 
              class="chart-fill" 
              [style.width.%]="getPercentage(item.amount)"
            ></div>
          </div>
          <div class="chart-value">{{ financeService.formatCurrency(item.amount) }}</div>
        </div>
      </div>
      <ng-template #noCategoryData>
        <p class="no-data">Nenhum dado disponível</p>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <!-- Por Forma de Pagamento -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="bar-chart"></ion-icon>
        Por Forma de Pagamento
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div *ngIf="getPaymentMethodEntries().length > 0; else noPaymentData">
        <div *ngFor="let item of getPaymentMethodEntries()" class="chart-item">
          <div class="chart-label">{{ item.method }}</div>
          <div class="chart-bar">
            <div 
              class="chart-fill" 
              [style.width.%]="getPercentage(item.amount)"
            ></div>
          </div>
          <div class="chart-value">{{ financeService.formatCurrency(item.amount) }}</div>
        </div>
      </div>
      <ng-template #noPaymentData>
        <p class="no-data">Nenhum dado disponível</p>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <!-- Estatísticas -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Estatísticas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label>
          <h3>Total de Transações</h3>
          <p>{{ filteredTransactions.length }}</p>
        </ion-label>
      </ion-item>
      <ion-item>
        <ion-label>
          <h3>Média de Entradas</h3>
          <p>{{ financeService.formatCurrency(summary ? getAverage(summary.totalEntradas, 'entrada') : 0) }}</p>
        </ion-label>
      </ion-item>
      <ion-item>
        <ion-label>
          <h3>Média de Saídas</h3>
          <p>{{ financeService.formatCurrency(summary ? getAverage(summary.totalSaidas, 'saida') : 0) }}</p>
        </ion-label>
      </ion-item>
    </ion-card-content>
  </ion-card>
</ion-content>
