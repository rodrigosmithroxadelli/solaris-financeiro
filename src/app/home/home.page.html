
<ion-content class="dashboard-content dashboard-theme">

  <section class="greeting-card">
    <div class="greeting-avatar">
      <ion-icon name="person-circle-outline"></ion-icon>
    </div>
    <div class="greeting-text">
      <h2>Olá {{ currentUserName }}, {{ greetingLabel }}!</h2>
      <p>Hoje é dia {{ todayLabel }}</p>
    </div>
    <button class="circle-button" type="button">
      <ion-icon name="eye-outline"></ion-icon>
    </button>
  </section>

  <section class="dashboard-card">
    <div class="card-header">
      <div class="calendar-actions">
        <button class="icon-pill" type="button" (click)="goToPreviousMonth()">
          <ion-icon name="chevron-back-outline"></ion-icon>
        </button>
        <h3>{{ selectedMonthLabel }}</h3>
        <button class="icon-pill" type="button" (click)="goToNextMonth()">
          <ion-icon name="chevron-forward-outline"></ion-icon>
        </button>
      </div>
    </div>
    <div class="finance-grid finance-grid--two">
      <div class="finance-box positive">
        <h4>Entradas hoje</h4>
        <p>Valor total de todas as entradas no financeiro</p>
        <strong>{{ formattingService.formatCurrency(todaySummary.entradas) }}</strong>
      </div>
      <div class="finance-box negative">
        <h4>Saídas hoje</h4>
        <p>Valor total de todos os gastos do financeiro</p>
        <strong>{{ formattingService.formatCurrency(todaySummary.saidas) }}</strong>
      </div>
      <div class="finance-box warning">
        <h4>Pendente para pagamento</h4>
        <p>Valor total das entradas pendentes</p>
        <strong>{{ formattingService.formatCurrency(pendingPaymentsTotal) }}</strong>
      </div>
      <div class="finance-box neutral">
        <h4>Saldo total em caixa</h4>
        <p>Saldo total de entradas e saídas</p>
        <strong>{{ formattingService.formatCurrency(totalCashBalance) }}</strong>
      </div>
    </div>
  </section>

  <section class="dashboard-card">
    <div class="card-title">
      <ion-icon name="cash-outline"></ion-icon>
      <div>
        <h3>Resumo das vendas</h3>
        <p>{{ formattingService.formatCurrency(monthSummary.entradas) }} em vendas pagas em {{ selectedMonthLabel }}</p>
      </div>
    </div>
    <div class="sales-breakdown">
      <div class="breakdown-item">
        <span class="dot orange"></span>
        <span>Débito</span>
        <strong>{{ formattingService.formatCurrency(salesBreakdown.debito) }}</strong>
      </div>
      <div class="breakdown-item">
        <span class="dot green"></span>
        <span>Crédito</span>
        <strong>{{ formattingService.formatCurrency(salesBreakdown.credito) }}</strong>
      </div>
      <div class="breakdown-item">
        <span class="dot blue"></span>
        <span>Pix</span>
        <strong>{{ formattingService.formatCurrency(salesBreakdown.pix) }}</strong>
      </div>
      <div class="breakdown-item">
        <span class="dot red"></span>
        <span>Dinheiro</span>
        <strong>{{ formattingService.formatCurrency(salesBreakdown.dinheiro) }}</strong>
      </div>
    </div>
    <div class="sales-chart">
      <canvas #salesChart></canvas>
    </div>
  </section>

  <section class="dashboard-card" *ngIf="indicadoresEstrategicos as indicadores">
    <div class="card-title">
      <ion-icon name="stats-chart-outline"></ion-icon>
      <div>
        <h3>Indicadores estratégicos</h3>
        <p>Comparativo do mês atual vs anterior</p>
      </div>
    </div>
    <div class="finance-grid finance-grid--two">
      <div class="finance-box positive">
        <h4>Ticket médio</h4>
        <p>Atual {{ formattingService.formatCurrency(indicadores.ticketMedio.atual) }}</p>
        <strong>{{ formattingService.formatCurrency(indicadores.ticketMedio.anterior) }}</strong>
        <span class="muted">Mês anterior</span>
      </div>
      <div class="finance-box neutral">
        <h4>Conversão de OS</h4>
        <p>Atual {{ (indicadores.conversaoOs.atual * 100) | number:'1.0-1' }}%</p>
        <strong>{{ (indicadores.conversaoOs.anterior * 100) | number:'1.0-1' }}%</strong>
        <span class="muted">Mês anterior</span>
      </div>
    </div>
  </section>

  <section class="dashboard-card" *ngIf="indicadoresEstrategicos as indicadores">
    <div class="card-title">
      <ion-icon name="people-outline"></ion-icon>
      <div>
        <h3>Receita por cliente (Top 5)</h3>
        <p>Ranking do mês atual</p>
      </div>
    </div>
    <div *ngIf="indicadores.receitaPorCliente.atual.length > 0; else emptyClientes">
      <div class="top-client" *ngFor="let item of indicadores.receitaPorCliente.atual">
        <div class="client-avatar">
          <ion-icon name="person-circle-outline"></ion-icon>
        </div>
        <div>
          <h4>{{ item.label }}</h4>
          <p>Receita confirmada</p>
        </div>
        <div class="client-amount">
          {{ formattingService.formatCurrency(item.amount) }}
        </div>
      </div>
    </div>
    <ng-template #emptyClientes>
      <div class="empty-state">
        <p>Nenhuma receita por cliente no período.</p>
      </div>
    </ng-template>
  </section>

  <section class="dashboard-card" *ngIf="indicadoresEstrategicos as indicadores">
    <div class="card-title">
      <ion-icon name="cube-outline"></ion-icon>
      <div>
        <h3>Receita por tipo de serviço</h3>
        <p>Ranking do mês atual</p>
      </div>
    </div>
    <div *ngIf="indicadores.receitaPorServico.atual.length > 0; else emptyServicos">
      <div class="top-client" *ngFor="let item of indicadores.receitaPorServico.atual">
        <div class="client-avatar">
          <ion-icon name="cube-outline"></ion-icon>
        </div>
        <div>
          <h4>{{ item.label }}</h4>
          <p>Receita confirmada</p>
        </div>
        <div class="client-amount">
          {{ formattingService.formatCurrency(item.amount) }}
        </div>
      </div>
    </div>
    <ng-template #emptyServicos>
      <div class="empty-state">
        <p>Nenhuma receita por serviço no período.</p>
      </div>
    </ng-template>
  </section>

  <section class="footer-card">
    <img src="assets/icon/logotipo-piloto-2.png" alt="Piloto" />
    <div class="social-icons">
      <ion-icon name="logo-instagram"></ion-icon>
      <ion-icon name="logo-youtube"></ion-icon>
      <ion-icon name="logo-facebook"></ion-icon>
      <ion-icon name="logo-whatsapp"></ion-icon>
    </div>
    <p>© Copyright 2026 Plataforma Piloto</p>
  </section>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="danger">
      <ion-icon name="help-circle-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>

